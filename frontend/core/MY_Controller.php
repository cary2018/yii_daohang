<?php/** * Created by PhpStorm. * User: asusa * Date: 2018/3/26/0026 * Author: Cary.He * Contact QQ  : 373889161($S$-Memory) * email: 373889161@qq.com * Time: 14:28 */namespace frontend\core;use yii\web\Controller;use frontend\models\Navigation;use frontend\models\Navisort;use frontend\models\Goods;class MY_Controller extends Controller{    /**     * 构造函数 初始化数据     */    public function init()    {    }    /**     * @param $type     * @return mixed     * 万的历当天信息     */    public function juhe_date($type)    {        $appkey = "dfbbe8198bb412fa50aeb16ae9105c82";        $url = "http://v.juhe.cn/calendar/day";        $params = array(            "key" => $appkey,//接口的appKey            "date" => $type,//指定日期,格式为YYYY-MM-DD,如月份和日期小于10,则取个位,如:2012-1-1        );        $paramstring = http_build_query($params);        $content = $this->juhecurl($url,$paramstring);        $news = json_decode($content,true);        return $news;    }    /**     * @param string $type 返回的新闻类型     * @return mixed     * 新闻函数     */    public function juhe_news($type='')    {        //类型,,top(头条，默认),shehui(社会),guonei(国内),guoji(国际),yule(娱乐),tiyu(体育)junshi(军事),keji(科技),caijing(财经),shishang(时尚)        //配置新闻的appkey        $appkey = "c1df6d8f53cf90621a40f87ba0323df2";        $url = "http://v.juhe.cn/toutiao/index";        $params = array(            "key" => $appkey,//接口的appKey            "type" => $type,//需要返回的新闻分类        );        $paramstring = http_build_query($params);        $content = $this->juhecurl($url,$paramstring);        $news = json_decode($content,true);        return $news;    }    /**     * 请求接口返回内容     * @param  string $url [请求的URL地址]     * @param  string $params [请求的参数]     * @param  int $ipost [是否采用POST形式]     * @return  string     */    private function juhecurl($url,$params=false,$ispost=0){        $httpInfo = array();        $ch = curl_init();        curl_setopt( $ch, CURLOPT_HTTP_VERSION , CURL_HTTP_VERSION_1_1 );        curl_setopt( $ch, CURLOPT_USERAGENT , 'JuheData' );        curl_setopt( $ch, CURLOPT_CONNECTTIMEOUT , 60 );        curl_setopt( $ch, CURLOPT_TIMEOUT , 60);        curl_setopt( $ch, CURLOPT_RETURNTRANSFER , true );        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);        if( $ispost )        {            curl_setopt( $ch , CURLOPT_POST , true );            curl_setopt( $ch , CURLOPT_POSTFIELDS , $params );            curl_setopt( $ch , CURLOPT_URL , $url );        }        else        {            if($params){                curl_setopt( $ch , CURLOPT_URL , $url.'?'.$params );            }else{                curl_setopt( $ch , CURLOPT_URL , $url);            }        }        $response = curl_exec( $ch );        if ($response === FALSE) {            //echo "cURL Error: " . curl_error($ch);            return false;        }        $httpCode = curl_getinfo( $ch , CURLINFO_HTTP_CODE );        $httpInfo = array_merge( $httpInfo , curl_getinfo( $ch ) );        curl_close( $ch );        return $response;    }    /**     * @param $id     * @return array|\yii\db\ActiveRecord[]     * 要显示的导航     */    public function shownav($id)    {        $query = Navigation::find();        $number = Navisort::findOne($id);        $model = $query->where(['is_show'=>1,'nav_pid'=>$id])->orderBy('ordery desc ,nav_id desc') //排序（多个排序,隔开）        ->select(['nav_name','nav_url','sun_name','sun_url','is_target'])   //要显示的字段        ->limit($number->number)     //限制显示数据        ->all();        return $model;    }    /**     * @param $id  商品分类ID     * @param $num  显示的数量     * @return mixed     * 调用商品分类     */    protected function goodsshow($id,$num)    {        $model = Goods::find();        $resco = $model->where(['cat_id'=>$id])->orderBy('id desc')            ->limit($num)            ->all();        return $resco;    }}