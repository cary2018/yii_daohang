<?php/** * Created by PhpStorm. * User: asusa * Date: 2018/3/28/0028 * Author: Cary.He * Contact QQ  : 373889161($S$-Memory) * email: 373889161@qq.com * Time: 14:31 */namespace backend\controllers;use Yii;use backend\core\MY_Controller;use backend\models\Article;use yii\helpers\ArrayHelper;use backend\models\Sort;class ArticleController extends MY_Controller{    /**     * @return string     * 文章列表     */    public function actionIndex()    {        $query = Article::find()->joinWith('sort');        //设置分页        $pagination = $this->Page($query);        $countries = $query->orderBy('id desc')            ->offset($pagination->offset)            ->limit($pagination->limit)            ->all();        return $this->render('index', [            'countries' => $countries,            'pagination' => $pagination,        ]);    }    /**     * @return string|\yii\web\Response     * 添加新文章     */    public function actionCreate()    {        $model = new Article();        $funhelp = new \Helpers();        $model->is_show=1;        //$model->scenario = 'create';    //设置 create 场景验证        $countries=Sort::find()->all();        $menu = $funhelp->gettree($countries,'pid','id','sort_name');        $nav = $funhelp->formenu($menu);        $listData=ArrayHelper::map($nav,'id','name'); //输出选择上级分类        if ($model->load(Yii::$app->request->post()) &&  $model->addmeg()) {            Yii::$app->session->setFlash('success','添加成功！'); //页面提示信息            return $this->redirect('index');  //跳转到提示页面        } else {            return $this->render('create', [                'model' => $model,                'listData' => $listData,            ]);        }    }    /**     * @param $id     * @return string|\yii\web\Response     * @throws \backend\core\NotFoundHttpException     * 编辑文章     */    public function actionEdit($id)    {        $funhelp = new \Helpers();        $model = $this->findArticle($id);        $countries=Sort::find()->all();        $menu = $funhelp->gettree($countries,'pid','id','sort_name');        $nav = $funhelp->formenu($menu);        $listData=ArrayHelper::map($nav,'id','name'); //输出选择上级分类        if($model->load(Yii::$app->request->post())){            $model->uptime = time();            $model->save();            Yii::$app->session->setFlash('success','编辑成功!');            return $this->redirect('index');        }        return $this->render('edit',[            'model'=>$model,            'listData'=>$listData,        ]);    }    /**     * @param $id     * @return \yii\web\Response     * 删除文章     */    public function actionDelete($id)    {        $this->findArticle($id)->delete();        return $this->redirect(['index']);    }}